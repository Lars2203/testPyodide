<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <style>
        .slider {
            margin: 20px 0;
        }
    </style>
    <py-env>
        - matplotlib
        - scikit-image
    </py-env>
</head>
<body>
    <h1>Image Thresholding and Morphological Operations</h1>
    
    <!-- Threshold Slider -->
    <label for="threshold">Threshold Value:</label>
    <input type="range" id="threshold" min="0" max="1" step="0.01" value="0.5" class="slider" oninput="applyTransformation()" />

    <!-- Kernel Size Slider -->
    <label for="kernel">Kernel Size:</label>
    <input type="range" id="kernel" min="1" max="15" step="1" value="3" class="slider" oninput="applyTransformation()" />

    <!-- Morphological Operation Switch -->
    <label for="operation">Operation:</label>
    <select id="operation" onchange="applyTransformation()">
        <option value="dilation">Dilation</option>
        <option value="erosion">Erosion</option>
    </select>

    <!-- Image Output -->
    <div id="image-output"></div>

    <py-script>
        from js import document
        from skimage import io, color, morphology
        import matplotlib.pyplot as plt
        import numpy as np
        import io, base64

        def applyTransformation():
            # Read input values
            threshold_value = float(document.getElementById("threshold").value)
            kernel_size = int(document.getElementById("kernel").value)
            operation = document.getElementById("operation").value

            # Load image and process
            img = io.imread('gray.png')  # Ensure 'gray.png' is present in the same folder
            gray_img = color.rgb2gray(img)

            # Thresholding
            binary_img = gray_img > threshold_value

            # Apply morphological operation
            if operation == "dilation":
                result_img = morphology.dilation(binary_img, morphology.square(kernel_size))
            else:
                result_img = morphology.erosion(binary_img, morphology.square(kernel_size))

            # Display result
            buf = io.BytesIO()
            plt.imshow(result_img, cmap='gray')
            plt.axis('off')
            plt.savefig(buf, format='png')
            buf.seek(0)
            img_str = "data:image/png;base64," + base64.b64encode(buf.read()).decode("utf-8")
            document.getElementById("output-img").src = img_str

        # Initial display setup
        applyTransformation()
    </py-script>

    <div id="image-container">
        <img id="output-img" alt="Processed Image"/>
    </div>
</body>
</html>
